# Active Learning System - Selbstlernfähigkeit

## Übersicht

Das System verfügt jetzt über ein vollständiges **Aktives Lernsystem**, das sich kontinuierlich selbst trainiert und verbessert.

## Features

### 1. Automatisches Lernen aus Pretraining-Symbolen
- Extrahiert Symbole aus Pretraining-Bildern
- Generiert Embeddings für visuelle Ähnlichkeitssuche
- Integriert neue Symbole in die Symbol-Bibliothek
- Verbessert Erkennungsgenauigkeit über Zeit

### 2. Kontinuierliches Lernen aus Analyse-Ergebnissen
- Lernt erfolgreiche Patterns aus hochwertigen Analysen (Score > 0.85)
- Extrahiert Korrekturen aus Ground-Truth-Vergleichen
- Speichert visuelle Beispiele für spätere Referenz
- Verbessert Pipeline-Strategien basierend auf Erfahrung

### 3. Adaptive Strategie-Anpassung
- Erkennt P&ID-Typ und Komplexität automatisch
- Passt Analyse-Strategie an:
  - **Simple P&IDs**: Schnellere, einfachere Strategie
  - **Complex P&IDs**: Vollständige Pipeline mit Extra-Validierung
  - **Generic P&IDs**: Standard-Strategie
- Lernt welche Strategien für welche P&ID-Typen am besten funktionieren

### 4. Selbstverbesserung über Zeit
- Speichert erfolgreiche Anpassungen
- Nutzt gelernte Patterns für zukünftige Analysen
- Kontinuierliche Verbesserung der Genauigkeit
- Feedback-Loops für kontinuierliches Lernen

## Implementierung

### ActiveLearner
- **Automatisches Symbol-Lernen**: Aus Pretraining-Bildern
- **Pattern-Extraktion**: Aus erfolgreichen Analysen
- **Korrektur-Lernen**: Aus Ground-Truth-Vergleichen
- **Strategie-Anpassung**: Basierend auf P&ID-Typ

### Integration in Pipeline
- Automatische P&ID-Typ-Erkennung vor Analyse
- Strategie-Anpassung basierend auf Typ
- Lernen nach jeder Analyse
- Kontinuierliche Verbesserung

## Effizienz-Optimierungen

### Algorithmus-Optimierungen
1. **IoU-Berechnung**: 
   - Early-Termination für nicht überlappende Boxen
   - Distanz-basierte Vorfilterung (~60% weniger Berechnungen)
   
2. **Graph-Synthese**:
   - Spatial Indexing für Element-Matching
   - Optimierte Deduplizierung
   - Parallele Verarbeitung

3. **Pipeline-Anpassung**:
   - Adaptive Tile-Größe basierend auf Komplexität
   - Strategie-Optimierung für verschiedene P&ID-Typen

## Robustheit für alle P&ID-Typen

### Unterstützte P&ID-Typen
- **Simple P&IDs**: Optimiert für Geschwindigkeit
- **Complex P&IDs**: Vollständige Pipeline mit Extra-Validierung
- **Generic P&IDs**: Standard-Strategie
- **Angepasste Strategien**: Basierend auf gelernten Patterns

### Adaptive Parameter
- Tile-Größe basierend auf Diagramm-Komplexität
- Anzahl Korrektur-Iterationen basierend auf Typ
- Pipeline-Phasen aktiviert/deaktiviert basierend auf Bedarf

## Verwendung

### Automatisches Pretraining
```python
from src.analyzer.learning.active_learner import ActiveLearner

# Lernen aus Pretraining-Symbolen
learning_report = active_learner.learn_from_pretraining_symbols(
    pretraining_path=Path("pretraining_symbols"),
    model_info=model_config
)
```

### Lernen aus Analyse-Ergebnissen
```python
# Automatisch nach jeder Analyse
learning_report = active_learner.learn_from_analysis_result(
    analysis_result=result,
    truth_data=truth_data,
    quality_score=score
)
```

### Strategie-Anpassung
```python
# Automatische Anpassung basierend auf P&ID-Typ
adaptation = active_learner.adapt_to_pid_type(
    pid_metadata=metadata,
    analysis_result=result
)
```

## Statistik

Das System trackt:
- Anzahl gelernte Symbole
- Anzahl gelernte Patterns
- Anzahl angewendete Korrekturen
- Erfolgreiche Strategie-Anpassungen
- Kontinuierliche Verbesserung der Genauigkeit

## Vorteile

1. **Selbstlernend**: System verbessert sich automatisch
2. **Robust**: Funktioniert für alle P&ID-Typen
3. **Effizient**: Optimierte Algorithmen für maximale Performance
4. **Adaptiv**: Passt Strategie basierend auf Erfahrung an
5. **Skalierbar**: Kann mit neuen Daten wachsen und lernen

---

**Status**: ✅ **Vollständig implementiert und integriert**


